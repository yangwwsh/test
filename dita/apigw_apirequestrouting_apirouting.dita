<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE concept PUBLIC "-//OASIS//DTD DITA Concept//EN" "concept.dtd">
<concept id="apigw_apirequestrouting_apirouting" xml:lang="en-us">
<title>API routing<ph rev="rev760"/></title>
<shortdesc>The <ph conref="apigw_conref.dita#common/apigw"/> runs the API routing action
to match the API to invoke.</shortdesc>
<conbody>
<p>The API routing action matches the API to invoke in the following process:<ol>
<li>The API routing action extracts the following information from the request: <ul>
<li>HTTP method to perform</li>
<li>Request URI</li>
</ul></li>
<li>The action then matches the API by matching the extracted information against the information of
all available APIs in the API collection.</li>
<li>When multiple APIs are matched, select the API with the longest base path.</li>
</ol></p>
<p>The following example shows an API collection with five API entries available through different
base paths. The HTTP method that is extracted from the API request is <codeph>POST</codeph>. The
request URI with routing prefix excluded is <codeph>/resource</codeph>. Although both A and D in the
following table are matched, D is selected because the base path of D is longer. <table
id="table_sjs_y1b_gy">
<title>API routing example</title>
<tgroup cols="5">
<colspec colname="newCol1" colnum="1" colwidth="1*"/>
<colspec colnum="2" colname="col1"/>
<colspec colnum="3" colname="col2"/>
<colspec colnum="4" colname="col3"/>
<colspec colnum="5" colname="col4"/>
<thead>
<row>
<entry>Entry</entry>
<entry>API name</entry>
<entry>Base path</entry>
<entry>Operation path</entry>
<entry>Operation</entry>
</row>
</thead>
<tbody>
<row>
<entry>A</entry>
<entry>X</entry>
<entry><codeph>/</codeph></entry>
<entry><codeph>/resource</codeph></entry>
<entry><codeph>POST</codeph></entry>
</row>
<row>
<entry>B</entry>
<entry>X</entry>
<entry><codeph>/</codeph></entry>
<entry><codeph>/resource/{id}</codeph></entry>
<entry><codeph>GET</codeph></entry>
</row>
<row>
<entry>C</entry>
<entry>Y</entry>
<entry><codeph>/resource</codeph></entry>
<entry><codeph>/101</codeph></entry>
<entry><codeph>GET</codeph></entry>
</row>
<row>
<entry>D</entry>
<entry>Y</entry>
<entry><codeph>/resource</codeph></entry>
<entry><codeph>/</codeph></entry>
<entry><codeph>POST</codeph></entry>
</row>
<row>
<entry>E</entry>
<entry>Y</entry>
<entry><codeph>/resource</codeph></entry>
<entry><codeph>/{count}</codeph></entry>
<entry><codeph>GET</codeph></entry>
</row>
</tbody>
</tgroup>
</table>The output of the API routing action is an API that is described by the API name, path name,
and operation name. The API processing then proceeds to the client identification phase. If no API
is matched, the request is rejected.</p>
<p>In addition, the following rules apply:<ul>
<li>The action selects the exactly matched candidate instead of the regex matched candidate. For
example, if the parameter <codeph>{count}</codeph> in the operation path of E is
<codeph>101</codeph>, a request with URL <codeph>http://&lt;host>/resource/101</codeph> matches C
and E. However, C is selected because C is the exact match.</li>
<li>When the target API operation is <codeph>POST</codeph>, the action checks whether the consumable
content types are defined at the API and operation level. If the consumable types are defined, the
action then examines the content type of the incoming request and drops the candidates whose
consumable types do not match the content type of the request.</li>
</ul></p>
</conbody>
</concept>
