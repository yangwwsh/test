<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE task PUBLIC "-//OASIS//DTD DITA Task//EN" "task.dtd">
<task id="apigw_addinginvokeaction" xml:lang="en-us">
<title>Adding an invoke action to retrieve documents<ph rev="rev760"/></title>
<shortdesc>An invoke action retrieves a document from a specified target URL from within the
assembly. The invoke action sends a request that can include a payload to the target and stores the
response in the specified variable in the API context.</shortdesc>
<taskbody>
<context>
<p>For a PUT or POST request, the invoke action retrieves the headers and payload from the API
context and sends the retrieved data to the target URL. For a GET request, the headers are retrieved
from the API context, but no payload is sent. After the invoke action receives the response, it
stores the response back into the variable that is specified by the <uicontrol>Output</uicontrol>
property. By default, the response is stored in the <codeph>message</codeph> context variable.</p>
<p>When multiple invoke actions are used within the same assembly, the output of each invoke task
might have a different variable name based on your need.</p>
<p>You can set whether to enable the <uicontrol>Stop on error</uicontrol> property. <ul>
<li>When enabled, the assembly flow can stop on the following type of errors.<dl>
<dlentry>
<dt>Connection error</dt>
<dd>The invoke action cannot establish a connection to the target URL. For example, the host is not
reachable or the service is not available.</dd>
</dlentry>
<dlentry>
<dt>SOAP error</dt>
<dd>The the invoke action receives a 500 SOAP fault as response.</dd>
</dlentry>
<dlentry>
<dt>Operation error</dt>
<dd>The invoke action establishes the connection and receives a non-2xx response in return.</dd>
</dlentry>
</dl><ul>
<li>When such an error occurs during the API call, an error is thrown. The invoke action stores the
error message into the API context and aborts the assembly execution. Here is a sample error
message.<codeblock>{
  name: 'ConnectionError',
  message: 'Invalid URL'
}</codeblock></li>
<li>When no error is of the specified type, the invoke action completes and executes the next action
in the assembly.</li>
</ul></li>
<li>When disabled, the assembly flow continues regardless of an error.</li>
</ul></p>
<p>With the cache type, you can set whether and how to cache documents in the response.<dl>
<dlentry>
<dt>No cache</dt>
<dd>Does not cache any documents.</dd>
</dlentry>
<dlentry>
<dt>Protocol</dt>
<dd>Uses the cache behavior that is defined by the Cache-Control headers on the request and
response. When used, the invoke action forwards the Cache-Control header from the client to the
target and sends the Cache-Control header from the target back to the client.</dd>
</dlentry>
<dlentry>
<dt>Time to live</dt>
<dd>Keeps documents in the cache for a specified time. When used, you must specify the validity
period for documents in the cache.</dd>
</dlentry>
</dl></p>
<p>When the cache type is <uicontrol>Protocol</uicontrol> or <uicontrol>Time to live</uicontrol>,
you can specify a cache key, or unique identifier, for the document cache entry. By default, the URL
is used as the key.</p>
</context>
<steps>
<step conref="apigw_conref.dita#commonsteps/search_assembly">
<cmd/>
</step>
<step>
<cmd>From the search results, select <uicontrol>Assembly Invoke Action</uicontrol>.</cmd>
</step>
<step conref="apigw_conref.dita#commonsteps/config_add">
<cmd/>
</step>
<step conref="apigw_conref.dita#commonsteps/config_basicproperties">
<cmd/>
</step>
<step>
<cmd>Specify the URL to be invoked.</cmd>
</step>
<step importance="optional">
<cmd>Specify the SSL client profile to secure connections between the <ph
conref="apigw_conref.dita#common/idag2nd"/> and the target URL.</cmd>
</step>
<step importance="optional">
<cmd>Specify the time to wait before the <ph conref="apigw_conref.dita#common/idag2nd"/>
receives a reply from the target.</cmd>
</step>
<step importance="optional">
<cmd>Specify the user name to use for HTTP basic authentication.</cmd>
</step>
<step importance="optional">
<cmd>Specify the password alias of the user password to use for HTTP basic authentication.</cmd>
</step>
<step>
<cmd>Specify the HTTP method to use for the invocation.</cmd>
<info>When you set the method to <uicontrol>Keep</uicontrol>, the HTTP method from the incoming
request is used.</info>
</step>
<step>
<cmd>Set whether to enable HTTP compression.</cmd>
</step>
<step>
<cmd>Define the document cache settings.</cmd>
<substeps>
<substep>
<cmd>Set the cache type.</cmd>
<info>This property takes effect only when a response is received from the target. When it is set,
the invoke action always returns the non-expired response that is previously saved in cache.</info>
</substep>
<substep>
<cmd>When the cache type is set to <uicontrol>Time to Live</uicontrol>, specify the validity period
for documents in the cache.</cmd>
</substep>
<substep>
<cmd>When the cache type is set to <uicontrol>Time to Live</uicontrol> or
<uicontrol>Protocol</uicontrol>, specify a unique identifier to use as a key for the document cache
entry. When omitted, the entire URL string is used as the key.</cmd>
</substep>
</substeps>
</step>
<step>
<cmd>Set whether the flow stops when a particular type of error occurs during the assembly
execution.</cmd>
</step>
<step>
<cmd>When the flow is set to stop on error, specify the type of errors on which the flow
stops.</cmd>
</step>
<step>
<cmd>Specify the name of a variable to store the invoke action output.</cmd>
<info>By default, the output is stored in the <codeph>message.body</codeph> ,
<codeph>message.headers</codeph> , <codeph>message.statuscode</codeph> respectively in the API
context.</info>
</step>
<step conref="apigw_conref.dita#commonsteps/config_apply">
<cmd/>
</step>
<step conref="apigw_conref.dita#commonsteps/config_saveconfig">
<cmd/>
</step>
</steps>
</taskbody>
</task>
