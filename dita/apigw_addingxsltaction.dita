<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE task PUBLIC "-//OASIS//DTD DITA Task//EN" "task.dtd">
<task id="apigw_addingxsltaction" xml:lang="en-us">
<title>Adding an XSLT action to run a stylesheet for the current payload<ph rev="rev760"/></title>
<shortdesc>You can use an assembly XSLT action to run a stylesheet for the current payload from the
API context.</shortdesc>
<taskbody>
<context>
<p>With the assembly XSLT action, you can perform the following actions within the assembly rule.<ul>
<li>Read and update the current payload. To read the current payload, you must refer to the <q>/</q>
document in your stylesheet. For example,
<codeblock>&lt;xsl:template match="/">
&lt;/xsl:template></codeblock>The current payload must be XML
and parsed by a parse action in advance. Otherwise, the <q>/</q> document is initialized as empty.
The generated output is used to update the current payload.</li>
<li>Get the original payload with the <codeph>apim:get-original-payload()</codeph> extension
function.</li>
<li>Get the API context variable with the <codeph>apim:get-variable()</codeph> extension
function.</li>
<li>Create or update the API context variable with the <codeph>apim:set-variable</codeph> extension
element.</li>
<li>Get the API property with the <codeph>apim:get-api-property()</codeph> extension function.</li>
<li>Designate an error for and abort the execution of the current assembly rule with the
<codeph>apim:reject</codeph> extension element.</li>
<li>Use other supported DP extension elements and functions to apply to the payload.</li>
</ul>See the reference information about the <codeph>apim</codeph> extension elements and functions
for the usage.</p>
</context>
<steps>
<step conref="apigw_conref.dita#commonsteps/search_assembly">
<cmd/>
</step>
<step>
<cmd>From the search results, select <uicontrol>Assembly XSLT Action</uicontrol>.</cmd>
</step>
<step conref="apigw_conref.dita#commonsteps/config_add">
<cmd/>
</step>
<step conref="apigw_conref.dita#commonsteps/config_basicproperties">
<cmd/>
</step>
<step>
<cmd>Select whether to use the current payload as the XSLT input.</cmd>
<info>By default, the property is not enabled.</info>
</step>
<step>
<cmd>Select the stylesheet to run.</cmd>
</step>
<step conref="apigw_conref.dita#commonsteps/config_apply">
<cmd/>
</step>
<step conref="apigw_conref.dita#commonsteps/config_saveconfig">
<cmd/>
</step>
</steps>
<example>
<title>Examples</title>
<ul>
<li>Read the <codeph>/order/@date</codeph> from the current payload and save it into the
<codeph>my.orderData</codeph> API context
variable.<codeblock>&lt;?xml version="1.0" encoding="utf-8"?>
&lt;xsl:stylesheet version="1.0"
    xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
    xmlns:apim="http://www.ibm.com/apimanagement"
    extension-element-prefixes="apim" exclude-result-prefixes="apim">

  &lt;xsl:template match="/">
    &lt;xsl:message>Found the order: &lt;xsl:copy-of select="./order"/>
    &lt;apim:set-variable name="'my.orderDate'" value="./order/@date"/>
  &lt;/xsl:template>
&lt;/xsl:stylesheet></codeblock></li>
<li>Update the current payload with the generated XML
document.<codeblock>&lt;?xml version="1.0" encoding="utf-8"?>
&lt;xsl:stylesheet version="1.0"
    xmlns:xsl="http://www.w3.org/1999/XSL/Transform">

  &lt;xsl:template match="/">
    &lt;order>
      &lt;item qty="2">Ink Cartridges&lt;/item>
      &lt;item qty="300">Copy Paper&lt;/item>
    &lt;/order>
  &lt;/xsl:template>
&lt;/xsl:stylesheet></codeblock></li>
</ul>
</example>
</taskbody>
<related-links>
<link href="apigw_extensions.dita"/>
<link href="functions.html" scope="peer" format="html">
<linktext>Extension elements and functions</linktext>
</link>
</related-links>
</task>
