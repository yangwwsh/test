<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-us" lang="en-us">
<head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

<meta name="copyright" content="© Copyright IBM Corporation 2017" />
<meta name="DC.Rights.Owner" content="© Copyright IBM Corporation 2017" />
<meta name="security" content="public" />
<meta name="Robots" content="index,follow" />
<meta name="DC.Type" content="task" />
<meta name="DC.Title" content="Adding an invoke action to retrieve documents" />
<meta name="abstract" content="An invoke action retrieves a document from a specified target URL from within the assembly. The invoke action sends a request that can include a payload to the target and stores the response in the specified variable in the API context." />
<meta name="Description" content="An invoke action retrieves a document from a specified target URL from within the assembly. The invoke action sends a request that can include a payload to the target and stores the response in the specified variable in the API context." />
<meta name="DC.Relation" scheme="URI" content="apigw_configuringassembly.html" />
<meta name="DC.Date" scheme="iso8601" content="2017-05-11" />
<meta name="DC.Format" content="XHTML" />
<meta name="DC.Identifier" content="apigw_addinginvokeaction" />
<meta name="DC.Language" content="en-us" />
<meta name="IBM.Country" content="ZZ" />
<!-- Licensed Materials - Property of IBM -->
<!-- US Government Users Restricted Rights -->
<!-- Use, duplication or disclosure restricted by -->
<!-- GSA ADP Schedule Contract with IBM Corp. -->
<link rel="stylesheet" type="text/css" href="./ibmdita.css" />
<link rel="Start" href="apigw_configuringassembly.html" />
<title>Adding an invoke action to retrieve documents</title>
</head>
<body id="apigw_addinginvokeaction"><div role="main">
<h1 class="title topictitle1">Adding an invoke action to retrieve documents<span class="ph"><img src="./7.6.0.gif" alt="7.6.0" /><img src="./end.gif" alt="" /></span></h1>
<div class="body taskbody"><p class="shortdesc">An invoke action retrieves a document from a specified target URL from within the
assembly. The invoke action sends a request that can include a payload to the target and stores the
response in the specified variable in the API context.</p>
<div class="section context"><div class="tasklabel"><h2 class="sectiontitle tasklabel" id="taskd798e19">About this task</h2></div><p class="p">For a PUT or POST request, the invoke action retrieves the headers and payload from the API
context and sends the retrieved data to the target URL. For a GET request, the headers are retrieved
from the API context, but no payload is sent. After the invoke action receives the response, it
stores the response back into the variable that is specified by the <span class="ph uicontrol">Output</span>
property. By default, the response is stored in the <samp class="ph codeph">message</samp> context variable.</p>

<p class="p">When multiple invoke actions are used within the same assembly, the output of each invoke task
might have a different variable name based on your need.</p>

<div class="p">You can set whether to enable the <span class="ph uicontrol">Stop on error</span> property. <ul class="ul"><li class="li">When enabled, the assembly flow can stop on the following type of errors.<dl class="dl"><dt class="dt dlterm">Connection error</dt>
<dd class="dd">The invoke action cannot establish a connection to the target URL. For example, the host is not
reachable or the service is not available.</dd>
<dt class="dt dlterm">SOAP error</dt>
<dd class="dd">The the invoke action receives a 500 SOAP fault as response.</dd>
<dt class="dt dlterm">Operation error</dt>
<dd class="dd">The invoke action establishes the connection and receives a non-2xx response in return.</dd>
</dl>
<ul class="ul"><li class="li">When such an error occurs during the API call, an error is thrown. The invoke action stores the
error message into the API context and aborts the assembly execution. Here is a sample error
message.<pre class="pre codeblock"><code>{
  name: 'ConnectionError',
  message: 'Invalid URL'
}</code></pre>
</li>
<li class="li">When no error is of the specified type, the invoke action completes and executes the next action
in the assembly.</li>
</ul>
</li>
<li class="li">When disabled, the assembly flow continues regardless of an error.</li>
</ul>
</div>

<div class="p">With the cache type, you can set whether and how to cache documents in the response.<dl class="dl"><dt class="dt dlterm">No cache</dt>
<dd class="dd">Does not cache any documents.</dd>
<dt class="dt dlterm">Protocol</dt>
<dd class="dd">Uses the cache behavior that is defined by the Cache-Control headers on the request and
response. When used, the invoke action forwards the Cache-Control header from the client to the
target and sends the Cache-Control header from the target back to the client.</dd>
<dt class="dt dlterm">Time to live</dt>
<dd class="dd">Keeps documents in the cache for a specified time. When used, you must specify the validity
period for documents in the cache.</dd>
</dl>
</div>

<p class="p">When the cache type is <span class="ph uicontrol">Protocol</span> or <span class="ph uicontrol">Time to live</span>,
you can specify a cache key, or unique identifier, for the document cache entry. By default, the URL
is used as the key.</p>
</div>
<div class="tasklabel"><h2 class="sectiontitle tasklabel" id="taskd798e93">Procedure</h2></div><ol class="ol steps"><li class="li step stepexpand"><span class="ph cmd">In the search field, enter <kbd class="ph userinput">assembly</kbd>.</span></li>
<li class="li step stepexpand"><span class="ph cmd">From the search results, select <span class="ph uicontrol">Assembly Invoke Action</span>.</span></li>
<li class="li step stepexpand"><span class="ph cmd">Click <span class="ph uicontrol">Add</span> or <span class="ph uicontrol">New</span>.</span></li>
<li class="li step stepexpand"><span class="ph cmd">Define the basic properties: Name, administrative state, and descriptive summary.</span></li>
<li class="li step stepexpand"><span class="ph cmd">Specify the URL to be invoked.</span></li>
<li class="li step stepexpand">Optional: <span class="ph cmd">Specify the SSL client profile to secure connections between the <span class="ph">DataPower® Gateway</span> and the target URL.</span></li>
<li class="li step stepexpand">Optional: <span class="ph cmd">Specify the time to wait before the <span class="ph">DataPower Gateway</span>
receives a reply from the target.</span></li>
<li class="li step stepexpand">Optional: <span class="ph cmd">Specify the user name to use for HTTP basic authentication.</span></li>
<li class="li step stepexpand">Optional: <span class="ph cmd">Specify the password alias of the user password to use for HTTP basic authentication.</span></li>
<li class="li step stepexpand"><span class="ph cmd">Specify the HTTP method to use for the invocation.</span> When you set the method to <span class="ph uicontrol">Keep</span>, the HTTP method from the incoming
request is used.</li>
<li class="li step stepexpand"><span class="ph cmd">Set whether to enable HTTP compression.</span></li>
<li class="li step stepexpand"><span class="ph cmd">Define the document cache settings.</span> <ol type="a" class="ol substeps"><li class="li substep"><span class="ph cmd">Set the cache type.</span> This property takes effect only when a response is received from the target. When it is set,
the invoke action always returns the non-expired response that is previously saved in cache.</li>
<li class="li substep"><span class="ph cmd">When the cache type is set to <span class="ph uicontrol">Time to Live</span>, specify the validity period
for documents in the cache.</span></li>
<li class="li substep"><span class="ph cmd">When the cache type is set to <span class="ph uicontrol">Time to Live</span> or
<span class="ph uicontrol">Protocol</span>, specify a unique identifier to use as a key for the document cache
entry. When omitted, the entire URL string is used as the key.</span></li>
</ol>
</li>
<li class="li step stepexpand"><span class="ph cmd">Set whether the flow stops when a particular type of error occurs during the assembly
execution.</span></li>
<li class="li step stepexpand"><span class="ph cmd">When the flow is set to stop on error, specify the type of errors on which the flow
stops.</span></li>
<li class="li step stepexpand"><span class="ph cmd">Specify the name of a variable to store the invoke action output.</span> By default, the output is stored in the <samp class="ph codeph">message.body</samp> ,
<samp class="ph codeph">message.headers</samp> , <samp class="ph codeph">message.statuscode</samp> respectively in the API
context.</li>
<li class="li step stepexpand"><span class="ph cmd">Click <span class="ph uicontrol">Apply</span> to save the changes to the running configuration.</span></li>
<li class="li step stepexpand"><span class="ph cmd">Click <span class="ph uicontrol">Save Configuration</span> or <span class="ph uicontrol">Save changes</span> to save
the changes to the persisted configuration.</span></li>
</ol>
</div>
<div class="related-links">
<div class="familylinks">
<div class="parentlink"><strong>Parent topic:</strong> <a class="link" href="apigw_configuringassembly.html" title="An assembly defines the data processing capabilities of an API definition. When an API is matched for an API request, the API execute action in the API processing rule runs the assembly of the API to respond to the request. The information instructs how to create an assembly.">Creating an assembly</a></div>
</div>
</div></div></body>
</html>