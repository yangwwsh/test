<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xml:lang="en-us" lang="en-us">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"></meta>
<meta name="copyright" content="© Copyright IBM Corporation 2017"></meta>
<meta name="DC.Rights.Owner" content="© Copyright IBM Corporation 2017"></meta>
<meta name="security" content="public"></meta>
<meta name="Robots" content="index,follow"></meta>
<meta name="DC.Type" content="apiPackage"></meta>
<meta name="DC.Title" content="apim module"></meta>
<meta name="abstract" content="The apim module can manipulate data that is used in the API Gateway service."></meta>
<meta name="Description" content="The apim module can manipulate data that is used in the API Gateway service."></meta>
<meta name="DC.Relation" scheme="URI" content="apigw_addinggatewayscriptaction.html"></meta>
<meta name="DC.Relation" scheme="URI" content="apigateway_gatewayscript_general.html"></meta>
<meta name="DC.Date" scheme="iso8601" content="2017-05-11"></meta>
<meta name="DC.Format" content="XHTML"></meta>
<meta name="DC.Identifier" content="apim_js"></meta>
<meta name="DC.Language" content="en-us"></meta>
<meta name="IBM.Country" content="ZZ"></meta>
<!-- Licensed Materials - Property of IBM -->
<!-- US Government Users Restricted Rights -->
<!-- Use, duplication or disclosure restricted by -->
<!-- GSA ADP Schedule Contract with IBM Corp. -->
<link rel="stylesheet" type="text/css" href="./ibmdita.css"></link>
<link rel="stylesheet" type="text/css" href="./ibmapiref.css"></link>
<title>apim module</title>
</head>
<body id="apim_js"><div role="main">
<h1 class="title title apiName topictitle1"><samp class="ph codeph">apim</samp> module<span class="ph"><img src="./7.6.0.gif" alt="7.6.0"></img><img src="./end.gif" alt=""></img></span></h1>
<div class="body refbody apiDetail"><p class="shortdesc">The <samp class="ph codeph">apim</samp> module can manipulate data that is used in the <span class="ph">API Gateway</span> service.</p>
<div class="section section apiDesc"><h4 class="sectiontitle">Description</h4><p class="p">The <samp class="ph codeph">apim</samp> module is available without using an explicit
<samp class="ph codeph">require('apim')</samp> statement. This module is automatically attached to the
<samp class="ph codeph">Global</samp> object.</p>

<p class="p"><strong class="ph b">Availability</strong></p>

<p class="p">The assembly <span class="ph">GatewayScript</span> action of the <span class="ph">API Gateway</span> service.</p>

<div class="p">This module supports the following APIs:<ul class="ul"><li class="li"><a class="xref" href="#apim.getCurrentPayload" title="Retrieves the API payload of the current message for the assembly GatewayScript action.">apim.getCurrentPayload()</a></li>
<li class="li"><a class="xref" href="#apim.getOriginalPayload" title="Retrieves the original API payload of the message when the message was initially received for the assembly GatewayScript action.">apim.getOriginalPayload()</a></li>
<li class="li"><a class="xref" href="#apim.getVariable" title="Retrieves the value of an API context variable.">apim.getVariable()</a></li>
<li class="li"><a class="xref" href="#apim.reject" title="Throws a custom error to the assembly rule and terminates the currently assembly rule.">apim.error()</a></li>
<li class="li"><a class="xref" href="#apim.setVariable" title="Sets, adds, or clears an API context variable.">apim.setVariable()</a></li>
<li class="li"><a class="xref" href="#apim.write" title="Supports writing to an API contexts.">apim.write()</a></li>
</ul>
</div>
</div>
</div>
<hr></hr><div class="related-links">
<div class="familylinks">
<div class="parentlink"><strong>Parent topic:</strong> <a class="link" href="apigateway_gatewayscript_general.html" title="The GatewayScript programming in API Gateway follows the programming guidelines of the DataPower Gateway Gateway programming model.">GatewayScript APIs for API management</a></div>
</div>
<div class="relinfo reltasks"><strong>Related tasks</strong>:<br></br>
<div><a class="link" href="apigw_addinggatewayscriptaction.html" title="Add a GatewayScript action to the assembly. The GatewayScript action uses a specified GatewayScript file in a directory on the DataPower Gateway.">Adding a GatewayScript action</a></div>
</div>
</div><div class="topic reference apiRef apiOperation nested1" xml:lang="en-us" id="apim.getCurrentPayload"><h2 class="title title apiName topictitle2"><samp class="ph codeph">apim.getCurrentPayload()</samp></h2>
<div class="body refbody apiDetail apiOperationDetail"><p class="shortdesc">Retrieves the API payload of the current message for the assembly <span class="ph">GatewayScript</span> action.</p>
<h4 class="sectiontitle">Syntax</h4><pre class="apiSyntaxText">apim.getCurrentPayload()</pre><div class="section section apiDesc"><h4 class="sectiontitle">Description</h4>The current payload must be XML and parsed by a parse action first. Otherwise, this
function returns
empty.</div>
</div>
<hr></hr></div>
<div class="topic reference apiRef apiOperation nested1" xml:lang="en-us" id="apim.getOriginalPayload"><h2 class="title title apiName topictitle2"><samp class="ph codeph">apim.getOriginalPayload()</samp></h2>
<div class="body refbody apiDetail apiOperationDetail"><p class="shortdesc">Retrieves the original API payload of the message when the message was initially received
for the assembly <span class="ph">GatewayScript</span> action.</p>
<h4 class="sectiontitle">Syntax</h4><pre class="apiSyntaxText">apim.getOriginalPayload()</pre><div class="section section apiDesc"><h4 class="sectiontitle">Description</h4>The original payload must be XML and parsed by a parse action first. Otherwise, this
function returns empty.</div>
</div>
<hr></hr></div>
<div class="topic reference apiRef apiOperation nested1" xml:lang="en-us" id="apim.getVariable"><h2 class="title title apiName topictitle2"><samp class="ph codeph">apim.getVariable()</samp></h2>
<div class="body refbody apiDetail apiOperationDetail"><p class="shortdesc">Retrieves the value of an API context variable.</p>
<h4 class="sectiontitle">Syntax</h4><pre class="apiSyntaxText">api.getVariable(<var class="keyword varname">name</var>)</pre><table class="itemdefs"><tr class="itemdef"><td class="itemdefname" valign="top">name</td><td class="itemdefnote" valign="top">The name of the API context variable. When the variable is an API property. this
parameter indicates the property name. This parameter is a string. </td></tr></table><div class="section section apiDesc"><h4 class="sectiontitle">Description</h4>The <samp class="ph codeph">api.getVariable()</samp> retrieves the value of an API context variable. It
returns <samp class="ph codeph">undefined</samp> if the variable does not exist. <div class="p">The format of the
<var class="keyword varname">name</var> parameter depends on:<ul class="ul"><li class="li">When the variable is not an API property, such as the <samp class="ph codeph">request.headers</samp> variable,
the <var class="keyword varname">name</var> format can be
<samp class="ph codeph">request.headers.<var class="keyword varname">headername</var></samp> or
<samp class="ph codeph">request.headers["<var class="keyword varname">headername</var>"]</samp>. For example:<ul class="ul"><li class="li"><samp class="ph codeph">api.getVariable('request.headers.Content-Type')</samp></li>
<li class="li"><samp class="ph codeph">api.getVariable('request.headers["Content-Type"]')</samp></li>
</ul>
</li>
<li class="li">When the variable is an API property, the <var class="keyword varname">name</var> format can be specified by one
of the following methods, where the <var class="keyword varname">property_name</var> indicates the property name.<ul class="ul"><li class="li"><samp class="ph codeph">apim.getVariable('<var class="keyword varname">property_name</var>')</samp></li>
<li class="li"><samp class="ph codeph">api.getVariable('api.properties.<var class="keyword varname">property_name</var>')</samp></li>
</ul>
</li>
</ul>
</div>
</div>
<div class="section section apiDesc" id="apim.getVariable__dataconversions"><h4 class="sectiontitle">Data conversions</h4>A
variable is assigned with a value and then associated with a assembly processing context. The
variable can be written or read by different types of assembly actions within the scope of a
transaction. Between different assembly actions, data conversions take place before marshalling and
unmarshalling variables. For most data conversions, the type of data that is read is the same as the
type of data that is written. A few cases result in that data type is different from that is
originally set into a variable.
<div class="tablenoborder"><table cellpadding="4" cellspacing="0" summary="" id="apim.getVariable__table_emx_4gw_nz" class="table" rules="all" frame="border" border="1"><caption><span class="tablecap">Table 1. Data conversion exceptions</span></caption><thead class="thead" align="left"><tr class="row" valign="bottom"><th class="entry" valign="bottom" width="20.2020202020202%" id="d16512e257">Data</th>
<th class="entry" valign="bottom" width="79.7979797979798%" id="d16512e259">Conversion</th>
</tr>
</thead>
<tbody class="tbody"><tr class="row"><td class="entry" valign="top" width="20.2020202020202%" headers="d16512e257 ">Array</td>
<td class="entry" valign="top" width="79.7979797979798%" headers="d16512e259 ">The <samp class="ph codeph">getVariable()</samp> API returns a JavaScript
<samp class="ph codeph">array</samp> for a variable that was originally set to a JavaScript
<samp class="ph codeph">Array</samp>.</td>
</tr>
<tr class="row"><td class="entry" valign="top" width="20.2020202020202%" headers="d16512e257 ">Boolean</td>
<td class="entry" valign="top" width="79.7979797979798%" headers="d16512e259 ">The <samp class="ph codeph">getVariable()</samp> API returns a JavaScript
<samp class="ph codeph">ture</samp> or <samp class="ph codeph">false</samp> for a variable that was originally set to a
JavaScript <samp class="ph codeph">Boolean</samp>.</td>
</tr>
<tr class="row"><td class="entry" valign="top" width="20.2020202020202%" headers="d16512e257 ">NULL</td>
<td class="entry" valign="top" width="79.7979797979798%" headers="d16512e259 ">The <samp class="ph codeph">getVariable()</samp> API returns a JavaScript
<samp class="ph codeph">null</samp> for a variable that was originally set to a JavaScript
<samp class="ph codeph">NULL</samp>.</td>
</tr>
<tr class="row"><td class="entry" valign="top" width="20.2020202020202%" headers="d16512e257 ">Object</td>
<td class="entry" valign="top" width="79.7979797979798%" headers="d16512e259 ">The <samp class="ph codeph">getVariable()</samp> API returns a JavaScript
<samp class="ph codeph">object</samp> for a variable that was originally set to a JavaScript
<samp class="ph codeph">Object</samp>.</td>
</tr>
<tr class="row"><td class="entry" valign="top" width="20.2020202020202%" headers="d16512e257 ">String</td>
<td class="entry" valign="top" width="79.7979797979798%" headers="d16512e259 ">The <samp class="ph codeph">getVariable()</samp> API returns a JavaScript
<samp class="ph codeph">string</samp> for a variable that was originally set to a JavaScript
<samp class="ph codeph">String</samp>.</td>
</tr>
<tr class="row"><td class="entry" valign="top" width="20.2020202020202%" headers="d16512e257 "><samp class="ph codeph">drDynaPayload</samp></td>
<td class="entry" valign="top" width="79.7979797979798%" headers="d16512e259 ">The <samp class="ph codeph">getVariable()</samp> API returns a JavaScript
<samp class="ph codeph">buffer</samp> for a variable that was originally set to a JavaScript
<samp class="ph codeph">drDynaPayload</samp>.</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="example"><h4 class="sectiontitle">Examples</h4>
<ul class="ul"><li class="li">Retrieve the value of the <samp class="ph codeph">request.headers["Content-Type"]</samp>
variable.<pre class="pre codeblock"><code>apim.getVariable('request.headers["Content-Type"]')</code></pre>
</li>
<li class="li">Retrieve the value of the <samp class="ph codeph">test</samp> API
property.<pre class="pre codeblock"><code>api.getVariable('api.properties.test')</code></pre>
</li>
</ul>
</div>
</div>
<hr></hr><div class="related-links"><div class="relinfo relref"><strong>Related reference</strong>:<br></br>
<div><a class="link" href="apigw_contextvariables.html" title="An API context is a set of variables. The input and output of the processing and assembly actions are stored in these variables. You can access and manipulate these variables by referencing them through assembly actions.">Variables in the API context</a></div>
</div>
</div></div>
<div class="topic reference apiRef apiOperation nested1" xml:lang="en-us" id="apim.reject"><h2 class="title title apiName topictitle2"><samp class="ph codeph">apim.error()</samp></h2>
<div class="body refbody apiDetail apiOperationDetail"><p class="shortdesc">Throws a custom error to the assembly rule and terminates the currently assembly
rule.</p>
<h4 class="sectiontitle">Syntax</h4><pre class="apiSyntaxText">apim.error(<var class="keyword varname">errorName</var>, <var class="keyword varname">statusCode</var>, <var class="keyword varname">reasonPhrase</var>, <var class="keyword varname">errorMessage</var>)</pre><table class="itemdefs"><tr class="itemdef"><td class="itemdefname" valign="top">errorName</td><td class="itemdefnote" valign="top">The name of the error. This parameter is a string. The default value is
'<samp class="ph codeph">TransformError</samp>'.</td></tr><tr class="itemdef"><td class="itemdefname" valign="top">statusCode</td><td class="itemdefnote" valign="top">The HTTP status code of the required error. This parameter is an integer. Enter a value
in the range 400 - 999.</td></tr><tr class="itemdef"><td class="itemdefname" valign="top">reasonPhrase</td><td class="itemdefnote" valign="top">The HTTP reason phrase for the error. This parameter is a string.</td></tr><tr class="itemdef"><td class="itemdefname" valign="top">errorMessage</td><td class="itemdefnote" valign="top">The custom error message for the returned fault, including such as the troubleshooting
information. This parameter is a string.</td></tr></table><div class="section section apiDesc"><h4 class="sectiontitle">Description</h4>The <samp class="ph codeph">apim.error()</samp> API throws a custom error. Then, the <span class="ph">API Gateway</span> does not run the subsequent assembly actions
and the current assembly rule is ended. The <span class="ph">API Gateway</span> returns a error message when the API responses to the client.</div>
<div class="example"><h4 class="sectiontitle">Example</h4>
<div class="p"> Throw a custom <samp class="ph codeph">MyError</samp> error to the assembly
rule.<pre class="pre codeblock"><code>apim.error('MyError', 500, 'Internal Error', 'Some error message')</code></pre>
</div>
</div>
</div>
<hr></hr></div>
<div class="topic reference apiRef apiOperation nested1" xml:lang="en-us" id="apim.setVariable"><h2 class="title title apiName topictitle2"><samp class="ph codeph">apim.setVariable()</samp></h2>
<div class="body refbody apiDetail apiOperationDetail"><p class="shortdesc">Sets, adds, or clears an API context
variable.</p>
<h4 class="sectiontitle">Syntax</h4><pre class="apiSyntaxText">apim.setVariable(<var class="keyword varname">name</var>, <var class="keyword varname">value</var>[, <var class="keyword varname">action</var>])</pre><table class="itemdefs"><tr class="itemdef"><td class="itemdefname" valign="top">name</td><td class="itemdefnote" valign="top">The name of the API context variable. This parameter is a string.</td></tr><tr class="itemdef"><td class="itemdefname" valign="top">name</td><td class="itemdefnote" valign="top">The name of the API context variable. When the variable is an API property. this
parameter indicates the property name. This parameter is a string. </td></tr><tr class="itemdef"><td class="itemdefname" valign="top">value</td><td class="itemdefnote" valign="top">The value that is set to the variable. This parameter is required when you want to only
add or set the
variable.</td></tr><tr class="itemdef"><td class="itemdefname" valign="top">action</td><td class="itemdefnote" valign="top">The specific action for the variable, including setting, adding, or clearing the
variable. This parameter is a string. This parameter value can be <samp class="ph codeph">add</samp>, or
<samp class="ph codeph">clear</samp>, or <samp class="ph codeph">set</samp>. The default value is
<samp class="ph codeph">set</samp>.</td></tr></table><div class="section section apiDesc"><h4 class="sectiontitle">Description</h4>The <samp class="ph codeph">apim.setVariable()</samp> API can set, add, or clear an API context variable
in the following rules:<ul class="ul"><li class="li">The add action adds a variable. This action can add a new header or append a new entry of the
same header.</li>
<li class="li">The clear action deletes a variable. This action can remove a header when the data is processed
in the assembly flow.</li>
<li class="li">The set action works in following ways: <ul class="ul"><li class="li">When the specified variable does not exist, a new variable is created with assigned value. </li>
<li class="li">When the specified variable exists and it is not read-only, the configured value overrides the
existing value. </li>
</ul>
</li>
</ul>
<div class="p">The format of the <var class="keyword varname">name</var> parameter depends on:<ul class="ul"><li class="li">When the variable is not an API property, such as the <samp class="ph codeph">request.headers</samp> variable,
the <var class="keyword varname">name</var> format can be
<samp class="ph codeph">request.headers.<var class="keyword varname">headername</var></samp> or
<samp class="ph codeph">request.headers["<var class="keyword varname">headername</var>"]</samp>. For example:<ul class="ul"><li class="li"><samp class="ph codeph">api.setVariable('request.headers.Content-Type', "test", add )</samp></li>
<li class="li"><samp class="ph codeph">api.setVariable('request.headers["Content-Type"]', "test", add )</samp></li>
</ul>
</li>
<li class="li">When the variable is an API property, the <var class="keyword varname">name</var> format can be specified by one
of the following methods, where the <var class="keyword varname">property_name</var> indicates the property name.<ul class="ul"><li class="li"><samp class="ph codeph">apim.setVariable('<var class="keyword varname">property_name</var>', "test", add)</samp></li>
<li class="li"><samp class="ph codeph">api.setVariable('api.properties.<var class="keyword varname">property_name</var>', "test",
add)</samp></li>
</ul>
</li>
</ul>
</div>
<div class="p">When you assign value to the variable, follow these rules. Otherwise, error occurs and
the current set variable action is ended.<ul class="ul"><li class="li">The value must match the specified data type, number, string, or Boolean.</li>
<li class="li">You cannot add the <samp class="ph codeph">message.status.code</samp> variable. Instead, you can set it. The
data type of this variable must be number, and the assigned value must be three digits from 100
through 999.</li>
</ul>
</div>
</div>
<div class="example"><h4 class="sectiontitle">Examples</h4>
<ul class="ul"><li class="li">Add a new header that is named
<samp class="ph codeph">message.headers.test</samp>.<pre class="pre codeblock"><code>apim.setVariable("message.headers.test", "teststring", add)</code></pre>
</li>
<li class="li">Override the value of the existing <samp class="ph codeph">message.headers.test</samp>
variable.<pre class="pre codeblock"><code>apim.setVariable("message.headers.test", 2245, set)</code></pre>
</li>
<li class="li">Delete the <samp class="ph codeph">message.headers.test</samp>
variable.<pre class="pre codeblock"><code>apim.setVariable("message.headers.test", clear)</code></pre>
</li>
</ul>
</div>
</div>
<hr></hr><div class="related-links"><div class="relinfo relref"><strong>Related reference</strong>:<br></br>
<div><a class="link" href="apigw_contextvariables.html" title="An API context is a set of variables. The input and output of the processing and assembly actions are stored in these variables. You can access and manipulate these variables by referencing them through assembly actions.">Variables in the API context</a></div>
</div>
</div></div>
<div class="topic reference apiRef apiOperation nested1" xml:lang="en-us" id="apim.write"><h2 class="title title apiName topictitle2"><samp class="ph codeph">apim.write()</samp></h2>
<div class="body refbody apiDetail apiOperationDetail"><p class="shortdesc">Supports writing to an API contexts.</p>
<h4 class="sectiontitle">Syntax</h4><pre class="apiSyntaxText">apim.write(<var class="keyword varname">value</var>)</pre><table class="itemdefs"><tr class="itemdef"><td class="itemdefname" valign="top">value</td><td class="itemdefnote" valign="top">The name of the object to write. </td></tr></table><div class="section section apiDesc"><h4 class="sectiontitle">Description</h4>The <samp class="ph codeph">apim.write()</samp> API xxx <p class="p">Calling the <samp class="ph codeph">apim.write()</samp> API
to the same context overwrites the previous <samp class="ph codeph">apim.write()</samp> API calls to that context.
In effect, the <samp class="ph codeph">apim.write()</samp> API can be called only once on a context per
transaction.</p>
</div>
</div>
<hr></hr></div>
</div></body>
</html>